(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-420fd1dc"],{"0675":function(t,e,a){},"0d98":function(t,e,a){t.exports=a.p+"img/close-popup.cb7e35ba.svg"},"606e":function(t,e,a){"use strict";a("0675")},b8cb:function(t,e,a){t.exports=a.p+"img/pixel-swipe.730abdf9.svg"},f479:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"swap-popup"},[e("img",{staticClass:"close-btn",attrs:{src:a("0d98"),alt:""},on:{click:t.closePopup}}),e("p",{staticClass:"title"},[t._v("Swap")]),t.swapObject?e("p",{staticClass:"balance-text"},[t._v(" Balance: "+t._s(parseFloat(t.activeFromToken.balance).toFixed(4))+" ")]):t._e(),t.swapObject?[e("div",{staticClass:"target-row"},[e("p",{staticClass:"label-text"},[t._v("From")]),e("ValueInput",{attrs:{max:t.activeFromToken.balance,values:t.fromTokens,valueName:t.activeFromToken.name,error:t.mainValueError,parentValue:t.mainValue},on:{changeToken:t.changeFromToken,onchange:t.updateMainValue}})],1),e("img",{staticClass:"swap-icon",attrs:{src:a("b8cb"),alt:""}}),e("div",{staticClass:"target-row to-row"},[e("p",{staticClass:"label-text"},[t._v("To")]),e("ValueInput",{attrs:{valueName:t.activeToToken.name,values:t.toTokens,parentValue:t.pairValue,disabled:!0},on:{changeToken:t.changeToToken}})],1),e("button",{staticClass:"btn approve-btn",attrs:{disabled:!t.mainValue&&t.mainValueError},on:{click:t.swapHandler}},[t._v(" Swap ")])]:t._e()],2)},i=[];const s=()=>a.e("chunk-6bc0cf3f").then(a.bind(null,"6618"));var o={data(){return{swapObject:null,activeFromTokenIdx:0,activeToTokenIdx:1,mainValue:"",mainValueError:"",pairValueError:"",virtualPrice:0,updateInterval:null}},computed:{account(){return this.$store.getters.getAccount},activeFromToken(){return this.swapObject.tokens.find(t=>t.tokenIdx===this.activeFromTokenIdx)},activeToToken(){return this.swapObject.tokens.find(t=>t.tokenIdx===this.activeToTokenIdx)},fromTokens(){return this.swapObject.tokens.filter(t=>t.tokenIdx!==this.activeFromTokenIdx)},toTokens(){return 0===this.activeFromTokenIdx?this.swapObject.tokens.filter(t=>0!==t.tokenIdx&&t.tokenIdx!==this.activeToTokenIdx):[]},pairValue(){let t;0===this.activeFromTokenIdx&&(t=this.mainValue*this.activeToToken.rate),0!==this.activeFromTokenIdx&&(t=this.mainValue/this.activeFromToken.rate);let e=new RegExp("^-?\\d+(?:.\\d{0,"+(this.activeToToken.decimals||-1)+"})?");return t.toString().match(e)[0]}},methods:{toFixed(t,e){let a=new RegExp("^-?\\d+(?:.\\d{0,"+(e||-1)+"})?");return t.toString().match(a)[0]},changeToToken(t){this.activeToTokenIdx=t},changeFromToken(t){return this.mainValue="",this.mainValueError="",this.activeFromTokenIdx=t,0!==t?(this.activeToTokenIdx=0,!1):0===t&&0===this.activeToTokenIdx?(this.activeToTokenIdx=1,!1):void 0},closePopup(){this.$emit("close")},updateMainValue(t){if(t>this.activeFromToken.balance)return this.mainValueError="The value cannot be greater than "+this.activeFromToken.balance,!1;this.mainValueError="",this.mainValue=t},async swapHandler(){const t=await this.checkTokenAllowance(this.activeFromToken);if(!t)return!1;try{const t=this.$ethers.utils.parseUnits(this.mainValue.toString(),this.activeFromToken.decimals),e=this.toFixed(String(.95*this.pairValue),this.activeToToken.decimals),a=this.$ethers.utils.parseUnits(e.toString(),this.activeToToken.decimals),n=await this.swapObject.contractInstance["exchange_underlying(int128,int128,uint256,uint256)"](this.activeFromTokenIdx,this.activeToTokenIdx,t,a,{gasLimit:4e5});this.closePopup();await n.wait()}catch(e){}},async updateTokens(t=this.swapObject){return await Promise.all(t.tokens.map(t=>this.updateToken(t)))},async updateToken(t){let e;try{const a=await t.contractInstance.balanceOf(this.account,{gasLimit:6e5});e=this.$ethers.utils.formatUnits(a.toString(),t.decimals)}catch(a){}return{...t,balance:e}},async getVirtualPrice(t=this.swapObject.rateContract){try{const e=await t.get_virtual_price(),a=this.$ethers.utils.formatUnits(e.toString(),18);return a}catch(e){}},async checkTokenAllowance(t){try{if(!t.allowance){const e=await t.contractInstance.approve(this.swapObject.contractInstance.address,"0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),a=+e.toString()+1e3,n=await t.contractInstance.approve(this.swapObject.contractInstance.address,"0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",{gasLimit:a});await n.wait();return!0}return!0}catch(e){return!1}},async initPopup(){const t=this.$store.getters.getSwapObject;if(!t)return this.closePopup(),!1;const e=await this.updateTokens(t);this.virtualPrice=await this.getVirtualPrice(t.rateContract),this.swapObject={...t,tokens:e}}},async created(){await this.initPopup(),this.updateInterval=setInterval(async()=>{await this.initPopup()},5e3)},beforeDestroy(){clearInterval(this.updateInterval)},components:{ValueInput:s}},r=o,c=(a("606e"),a("2877")),f=Object(c["a"])(r,n,i,!1,null,"2d4e8158",null);e["default"]=f.exports}}]);